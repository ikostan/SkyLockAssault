name: Deploy to itch.io

on:
  workflow_call:  # Reusable

jobs:
  export-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Export Godot to Web
        id: export
        uses: firebelley/godot-export@v5.2.1  # Exports using your presets.cfg
        with:
          godot_executable_download_url: https://downloads.tuxfamily.org/godotengine/4.4.1/Godot_v4.4.1-stable_linux.x86_64.zip
          godot_export_templates_download_url: https://downloads.tuxfamily.org/godotengine/4.4.1/Godot_v4.4.1-stable_export_templates.tpz
          relative_project_path: ./  # Project root
          relative_export_path: ./export/web  # Output folder
          archive_output: true  # Zips for upload
          use_preset: itch-web  # Match your Web preset name (change if different)

      - name: Deploy to itch.io
        uses: Ayowel/butler-to-itch@v1.0.0  # Pushes via Butler
        with:
          butler_key: ${{ secrets.ITCHIO_API_KEY }}  # Your repo secret
          itch_user: ikostan  # Your itch.io username
          itch_game: sky-lock-assault  # Game slug (from URL)
          version: ${{ github.ref_name }}  # Branch/tag as version
          files: ${{ steps.export.outputs.archive_directory }}/itch-web.zip  # Zipped export
          channel: html5  # itch.io channel for Web