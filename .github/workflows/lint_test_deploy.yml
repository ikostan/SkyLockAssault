---
name: "Main Deploy Pipeline"

# Define permissions at the workflow level
permissions:
  contents: "write"
  pull-requests: "write"

on:  # yamllint disable-line rule:truthy
  push:
    branches: [main]  # Triggers on pushes to main

jobs:
  lint-readme:
    name: "Markdown Lint"
    uses: "./.github/workflows/lint_readme.yml"  # Calls the reusable lint workflow
  yamllint:
    name: "YAML Lint"
    uses: "./.github/workflows/yamllint.yml"
    with:
      config-path: ".github/workflows/*.yml"  # Pass the folder name parameter here
  deploy-itch:
    name: "Deploy to itch.io"
    needs:
      - "lint-readme"  # Only runs if lint succeeds
      - "yamllint"
    uses: "./.github/workflows/deploy_to_itch.yml"  # Calls the reusable deploy workflow
    secrets:
      ITCHIO_API_KEY: "${{ secrets.ITCHIO_API_KEY }}"
